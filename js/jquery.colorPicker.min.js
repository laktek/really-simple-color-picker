!function(e){var o,t,r,c=0,i={control:e('<div class="colorPicker-picker">&nbsp;</div>'),palette:e('<div id="colorPicker_palette" class="colorPicker-palette" />'),swatch:e('<div class="colorPicker-swatch">&nbsp;</div>'),hexLabel:e('<label for="colorPicker_hex">Hex</label>'),hexField:e('<input type="text" id="colorPicker_hex" />')},n="transparent";e.fn.colorPicker=function(o){return this.each(function(){var t,r,l=e(this),a=e.extend({},e.fn.colorPicker.defaults,o),s=e.fn.colorPicker.toHex(l.val().length>0?l.val():a.pickerDefault),d=i.control.clone(),f=i.palette.clone().attr("id","colorPicker_palette-"+c),u=i.hexLabel.clone(),h=i.hexField.clone(),P=f[0].id;if(e.each(a.colors,function(o){t=i.swatch.clone(),a.colors[o]===n?(t.addClass(n).text("X"),e.fn.colorPicker.bindPalette(h,t,n)):(t.css("background-color","#"+this),e.fn.colorPicker.bindPalette(h,t)),t.appendTo(f)}),u.attr("for","colorPicker_hex-"+c),h.attr({id:"colorPicker_hex-"+c,value:s}),h.bind("keydown",function(o){if(13===o.keyCode){var t=e.fn.colorPicker.toHex(e(this).val());e.fn.colorPicker.changeColor(t?t:l.val())}27===o.keyCode&&e.fn.colorPicker.hidePalette()}),h.bind("keyup",function(o){var t=e.fn.colorPicker.toHex(e(o.target).val());e.fn.colorPicker.previewColor(t?t:l.val())}),e('<div class="colorPicker_hexWrap" />').append(u).appendTo(f),f.find(".colorPicker_hexWrap").append(h),a.showHexField===!1&&(h.hide(),u.hide()),e("body").append(f),f.hide(),d.css("background-color",s),d.bind("click",function(){l.is(":not(:disabled)")&&e.fn.colorPicker.togglePalette(e("#"+P),e(this))}),o&&o.onColorChange?d.data("onColorChange",o.onColorChange):d.data("onColorChange",function(){}),(r=l.data("text"))&&d.html(r),l.after(d),l.bind("change",function(){l.next(".colorPicker-picker").css("background-color",e.fn.colorPicker.toHex(e(this).val()))}),l.val(s),"input"===l[0].tagName.toLowerCase())try{l.attr("type","hidden")}catch(e){l.css("visibility","hidden").css("position","absolute")}else l.hide();c++})},e.extend(!0,e.fn.colorPicker,{toHex:function(e){if(e.match(/[0-9A-F]{6}|[0-9A-F]{3}$/i))return"#"===e.charAt(0)?e:"#"+e;if(!e.match(/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/))return!1;var o=[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)],t=function(e){if(e.length<2)for(var o=0,t=2-e.length;o<t;o++)e="0"+e;return e};if(3===o.length){var r=t(o[0].toString(16)),c=t(o[1].toString(16)),i=t(o[2].toString(16));return"#"+r+c+i}},checkMouse:function(r,c){var i=t,n=e(r.target).parents("#"+i.attr("id")).length;r.target===e(i)[0]||r.target===o[0]||n>0||e.fn.colorPicker.hidePalette()},hidePalette:function(){e(document).unbind("mousedown",e.fn.colorPicker.checkMouse),e(".colorPicker-palette").hide()},calculatePalettePositionTop:function(t){var r=e(window),c=r.scrollTop()+r.height(),i=o.offset().top,n=o.outerHeight(),l=i+n,a=t.outerHeight(),s=l+a;return s>c&&(l=i-a),l},calculatePalettePositionLeft:function(t){var r=e(window),c=r.scrollLeft()+r.width(),i=o.offset().left,n=o.offset().left+o.outerWidth(),l=i,a=t.outerWidth(),s=l+a;if(s>c){var d=10;l=Math.min(n,c-d)-a}return l},adjustPalettePosition:function(o){var t=e.fn.colorPicker.calculatePalettePositionTop(o),r=e.fn.colorPicker.calculatePalettePositionLeft(o);o.css({top:t,left:r})},showPalette:function(t){var r=o.prev("input").val();e("#color_value").val(r),e.fn.colorPicker.adjustPalettePosition(t),t.show(),e(document).bind("mousedown",e.fn.colorPicker.checkMouse)},togglePalette:function(r,c){c&&(o=c),t=r,t.is(":visible")?e.fn.colorPicker.hidePalette():e.fn.colorPicker.showPalette(r)},changeColor:function(t){o.css("background-color",t),o.prev("input").val(t).change(),e.fn.colorPicker.hidePalette(),o.data("onColorChange").call(o,e(o).prev("input").attr("id"),t)},previewColor:function(e){o.css("background-color",e)},bindPalette:function(t,c,i){i=i?i:e.fn.colorPicker.toHex(c.css("background-color")),c.bind({click:function(o){r=i,e.fn.colorPicker.changeColor(i)},mouseover:function(o){r=t.val(),e(this).css("border-color","#598FEF"),t.val(i),e.fn.colorPicker.previewColor(i)},mouseout:function(c){e(this).css("border-color","#000"),t.val(o.css("background-color")),t.val(r),e.fn.colorPicker.previewColor(r)}})}}),e.fn.colorPicker.defaults={pickerDefault:"FFFFFF",colors:["000000","993300","333300","000080","333399","333333","800000","FF6600","808000","008000","008080","0000FF","666699","808080","FF0000","FF9900","99CC00","339966","33CCCC","3366FF","800080","999999","FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0","FF99CC","FFCC99","FFFF99","CCFFFF","99CCFF","FFFFFF"],addColors:[],showHexField:!0}}(jQuery);